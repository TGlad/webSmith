saveChanges?description=this+represents+a+collision+or+contact+between+two+objects.%0D%0AAn+interaction+will+have+several+ContactPoint+objects+as+components.&wikilink=&init=baseState.objects+%3D+%5B%5D%3B%0D%0AbaseState.objects%5B0%5D+%3D+parameters.object1%3B%0D%0AbaseState.objects%5B1%5D+%3D+parameters.object2%3B%0D%0A%0D%0AbackInSource.volumes+%3D+%5B%5D%3B%0D%0AbackInSource.volumes%5B0%5D+%3D+%7Bpointer%3AbaseState.objects%5B0%5D.backOut%2C+name%3A%27volume%27%7D%3B%0D%0AbackInSource.volumes%5B1%5D+%3D+%7Bpointer%3AbaseState.objects%5B1%5D.backOut%2C+name%3A%27volume%27%7D%3B%0D%0A%0D%0Adown.impulse+%3D+%5B%5D%3B%0D%0Adown.torqueImpulse+%3D+%5B%5D%3B%0D%0A%2F%2F+this+stuff+wouldn%27t+be+here+if+we+used+contact+objects%0D%0A%2F%2F+phew%2C+a+bit+heavy%0D%0AbackInSource.inverseInertia+%3D+%5B%7Bpointer%3AbaseState.objects%5B0%5D.backOut%2C+name%3A%27inverseInertia%27%7D%2C+%7Bpointer%3AbaseState.objects%5B1%5D.backOut%2C+name%3A%27inverseInertia%27%7D%5D%3B%0D%0AbackInSource.inverseMass+%3D+%5B%7Bpointer%3AbaseState.objects%5B0%5D.backOut%2C+name%3A%27inverseMass%27%7D%2C+%7Bpointer%3AbaseState.objects%5B1%5D.backOut%2C+name%3A%27inverseMass%27%7D%5D%3B%0D%0AbackInSource.velocity+%3D+%5B%7Bpointer%3AbaseState.objects%5B0%5D.backOut%2C+name%3A%27velocity%27%7D%2C+%7Bpointer%3AbaseState.objects%5B1%5D.backOut%2C+name%3A%27velocity%27%7D%5D%3B%0D%0AbackInSource.angularVelocity+%3D+%5B%7Bpointer%3AbaseState.objects%5B0%5D.backOut%2C+name%3A%27angularVelocity%27%7D%2C+%7Bpointer%3AbaseState.objects%5B1%5D.backOut%2C+name%3A%27angularVelocity%27%7D%5D%3B%0D%0AbackInSource.inertiaTransform+%3D+%5B%7Bpointer%3AbaseState.objects%5B0%5D.backOut%2C+name%3A%27inertiaTransform%27%7D%2C+%7Bpointer%3AbaseState.objects%5B1%5D.backOut%2C+name%3A%27inertiaTransform%27%7D%5D%3B%0D%0A%0D%0Adown.impulse+%3D+%5Bnew+Vector3%280%2C0%2C0%29%2C+new+Vector3%280%2C0%2C0%29%5D%3B%0D%0Adown.torqueImpulse+%3D+%5Bnew+Vector3%280%2C0%2C0%29%2C+new+Vector3%280%2C0%2C0%29%5D%3B%0D%0AoutDest.impulse+%3D+%5B%7Bpointer%3AbaseState.objects%5B0%5D.in%2C+name%3A%27impulse%27%7D%2C+%7Bpointer%3AbaseState.objects%5B1%5D.in%2C+name%3A%27impulse%27%7D%5D%3B%0D%0AoutDest.torqueImpulse+%3D+%5B%7Bpointer%3AbaseState.objects%5B0%5D.in%2C+name%3A%27torqueImpulse%27%7D%2C+%7Bpointer%3AbaseState.objects%5B1%5D.in%2C+name%3A%27torqueImpulse%27%7D%5D%3B&receive=&reply=&predict=&react=%2F%2F+find+whether+the+objects+are+intersecting%2C+and+where+the+contact+points+are%0D%0A%0D%0AImpulse+stickiness+%3D+0%3B%0D%0AScale+staticFriction+%3D+0.5%3B+%2F%2F+this+is+the+combined+friction+%28usually+a+multiply%29%0D%0AScale+restitution+%3D+0%3B+%2F%2F+bounce+factor+0+to+1%0D%0ADirection+normal+%3D+new+Vector3%28%29%3B%0D%0APosition+points+%3D+%5B%5D%3B%0D%0ALength+depths+%3D+%5B%5D%3B%0D%0Aif+%28up.volumes%5B0%5D.intersects%28up.volumes%5B1%5D%2C+normal%2C+points%2C+depths%29%29%0D%0A%7B%0D%0A++%2F%2F+we+could+create+some+contact+points+here%2C+but%3A%0D%0A++%2F%2F+1.+shouldn%27t+we+put+in+a+debug+draw+feature+about+now%3F%0D%0A++%2F%2F+2.+maybe+box-box+collision+should+involve+some+sort+of+memory+or+ID+to+match%0D%0A++%2F%2F+contacts+with+those+of+previous+frames%2C+for+coherency%0D%0A++var+numIterations+%3D+4%3B%0D%0A++Frequency+P+%3D+0.25%2FtimeStep+hertz%3B%0D%0A++Velocity+vel+%3D+%5Bnew+Vector3%28up.velocity%5B0%5D%29%2C+new+Vector3%28up.velocity%5B1%5D%29%5D%3B%0D%0A++Velocity+angVel+%3D+%5Bnew+Vector3%28up.angularVelocity%5B0%5D%29%2C+new+Vector3%28up.angularVelocity%5B1%5D%29%5D%3B%0D%0A++for+%28i+%3D+0%3B+i%3C2%3B+i%2B%2B%29+%2F%2F+if+no+inertia+is+passed+up+then+we+assume+it+can%27t+move%0D%0A++%7B%0D%0A++++if+%28up.inverseMass%5Bi%5D+%3D%3D+undefined%29%0D%0A++++++up.inverseMass%5Bi%5D+%3D+0%3B%0D%0A++++if+%28up.inverseInertia%5Bi%5D+%3D%3D+undefined%29%0D%0A++++++up.inverseInertia%5Bi%5D+%3D+new+Vector3%280%2C0%2C0%29%3B%0D%0A++%7D%0D%0A%0D%0A++%2F%2F+this+physics+includes+friction%2C+to+do+that+we+need+to+find+two+orthogonal+friction+axes%0D%0A++Direction+binormals+%3D+getBinormals%28normal%29%3B%0D%0A%0D%0A++%2F%2F+1.+precalculate+impulse+response+at+each+contact+point%0D%0A++Direction+normals+%3D+%5Bnormal%2C+binormals%5B0%5D%2C+binormals%5B1%5D%5D%3B++++++%0D%0A++Impulse+impulse+%3D+normals%3B++++++%0D%0A++Position+toCOM+%3D+%5B%5D%3B%0D%0A++InverseInertia+deltaAngVel+%3D+%5B%5D%3B%0D%0A++InverseMass+impulseResponse+%3D+%5B%5D%3B%0D%0A++Impulse+totalImpulse+%3D+%5B%5D%3B%0D%0A++Velocity+velNorm+%3D+%5B%5D%3B%0D%0A++Velocity+targetVel+%3D+%5B%5D%3B%0D%0A++for+%28k+in+points%29%0D%0A++%7B%0D%0A++++toCOM%5Bk%5D+%3D+%5B%5D%3B%0D%0A++++deltaAngVel%5Bk%5D+%3D+%5B%5D%3B%0D%0A++++InverseMass+deltaV+%3D+%5B%5D%3B%0D%0A++++velNorm%5Bk%5D+%3D+%5B%5D%3B%0D%0A++++targetVel%5Bk%5D+%3D+%5B%5D%3B%0D%0A++++for+%28i+%3D+0%3B+i%3C2%3B+i%2B%2B%29%0D%0A++++%7B%0D%0A++++++deltaAngVel%5Bk%5D%5Bi%5D+%3D+%5B%5D%3B%0D%0A++++++deltaV%5Bi%5D+%3D+%5B%5D%3B%0D%0A++++++toCOM%5Bk%5D%5Bi%5D+%3D+up.inertiaTransform%5Bi%5D.pos+.-+points%5Bk%5D%3B%0D%0A%0D%0A++++++velNorm%5Bk%5D%5Bi%5D+%3D+%28vel%5Bi%5D+.%2B+%28toCOM%5Bk%5D%5Bi%5D+.cross+angVel%5Bi%5D%29%29+.dot+normals%5B0%5D%3B%0D%0A++++++for+%28j+%3D+0%3B+j%3C3%3B+j%2B%2B%29%0D%0A++++++%7B%0D%0A++++++++TorqueImpulse+torqueImpulse+%3D+impulse%5Bj%5D+.cross+toCOM%5Bk%5D%5Bi%5D%3B%0D%0A++++++++TorqueImpulse+torqueLocal+%3D+up.inertiaTransform%5Bi%5D.quat%5E-1+.*+torqueImpulse%3B%0D%0A++++++++deltaAngVel%5Bk%5D%5Bi%5D%5Bj%5D+%3D+torqueLocal+.multiplyComponents+up.inverseInertia%5Bi%5D%3B%0D%0A++++++++deltaAngVel%5Bk%5D%5Bi%5D%5Bj%5D+.*%3D+up.inertiaTransform%5Bi%5D.quat%3B%0D%0A++++++++InverseMass+deltaVel+%3D+normals%5Bj%5D+.*+up.inverseMass%5Bi%5D%3B%0D%0A++++++++deltaV%5Bi%5D%5Bj%5D+%3D+%28deltaVel+.%2B+toCOM%5Bk%5D%5Bi%5D.cross%28deltaAngVel%5Bk%5D%5Bi%5D%5Bj%5D%29%29+.dot+normals%5Bj%5D%3B%0D%0A++++++%7D%0D%0A++++%7D%0D%0A++++Velocity+normalVel+%3D+velNorm%5Bk%5D%5B0%5D+-+velNorm%5Bk%5D%5B1%5D%3B%0D%0A++++targetVel%5Bk%5D%5B0%5D+%3D+-normalVel*restitution+%2B+depths%5Bk%5D+*+P%3B+%0D%0A++++%2F%2F+no+target+vel+for+lateral+friction%2C+unless+we+introduce+conveyer+belts%0D%0A++++targetVel%5Bk%5D%5B1%5D+%3D+0%3B%0D%0A++++targetVel%5Bk%5D%5B2%5D+%3D+0%3B%0D%0A%0D%0A++++impulseResponse%5Bk%5D+%3D+%5B%5D%3B%0D%0A++++totalImpulse%5Bk%5D+%3D+%5B%5D%3B%0D%0A++++for+%28j+%3D+0%3B+j%3C3%3B+j%2B%2B%29%0D%0A++++%7B%0D%0A++++++impulseResponse%5Bk%5D%5Bj%5D+%3D+deltaV%5B0%5D%5Bj%5D+-+deltaV%5B1%5D%5Bj%5D%3B%0D%0A++++++totalImpulse%5Bk%5D%5Bj%5D+%3D+0%3B%0D%0A++++%7D%0D%0A++%7D%0D%0A%0D%0A++%2F%2F+now+iterate+several+times%0D%0A++for+%28it+%3D+0%3B+it%3CnumIterations%3B+it%2B%2B%29%0D%0A++%7B%0D%0A++++for+%28k+in+points%29+%2F%2F+for+each+contact+point%0D%0A++++%7B%0D%0A++++++for+%28j+%3D+0%3B+j%3C3%3B+j%2B%2B%29+%2F%2F+for+each+degree+of+freedom%0D%0A++++++%7B%0D%0A++++++++%2F%2F+2.+find+the+target+deltaV%0D%0A++++++++Velocity+velNorm+%3D+%5B%5D%3B%0D%0A++++++++for+%28i+%3D+0%3B+i%3C2%3B+i%2B%2B%29%0D%0A++++++++++velNorm%5Bi%5D+%3D+%28vel%5Bi%5D+.%2B+%28toCOM%5Bk%5D%5Bi%5D+.cross+angVel%5Bi%5D%29%29+.dot+normals%5Bj%5D%3B%0D%0A++++++++Velocity+normalVel+%3D+velNorm%5B0%5D+-+velNorm%5B1%5D%3B%0D%0A++++++++Velocity+targetDeltaV+%3D+targetVel%5Bk%5D%5Bj%5D+-+normalVel%3B%0D%0A++++++%0D%0A++++++++%2F%2F+3.+work+out+impulse+needed+to+cause+targetDeltaV++++++%0D%0A++++++++Impulse+impulseToApply+%3D+targetDeltaV+%2F+impulseResponse%5Bk%5D%5Bj%5D%3B%0D%0A%0D%0A++++++++%2F%2F+4.+update+the+total+impulse+and+torque+impulse+that+we+are+applying%0D%0A++++++++totalImpulse%5Bk%5D%5Bj%5D+%2B%3D+impulseToApply%3B%0D%0A++++++++var+clamped+%3D+false%3B%0D%0A++++++++if+%28j+%3D%3D+0%29+%2F%2F+reaction+impulse%0D%0A++++++++%7B%0D%0A++++++++++if+%28totalImpulse%5Bk%5D%5Bj%5D+%3C+-stickiness%29+%2F%2F+unilateral+constraint%0D%0A++++++++++%7B%0D%0A++++++++++++impulseToApply+%2B%3D+-stickiness+-+totalImpulse%5Bk%5D%5Bj%5D%3B%0D%0A++++++++++++totalImpulse%5Bk%5D%5Bj%5D+%3D+-stickiness%3B%0D%0A++++++++++++clamped+%3D+true%3B%0D%0A++++++++++%7D%0D%0A++++++++%7D%0D%0A++++++++else+%2F%2F+frictional+impulse%0D%0A++++++++%7B%0D%0A++++++++++Impulse+maxImpulse+%3D+staticFriction*%28totalImpulse%5Bk%5D%5B0%5D%2Bstickiness%29%3B%0D%0A++++++++++if+%28totalImpulse%5Bk%5D%5Bj%5D+%3E+maxImpulse%29+%0D%0A++++++++++%7B%0D%0A++++++++++++impulseToApply+%2B%3D+maxImpulse+-+totalImpulse%5Bk%5D%5Bj%5D%3B%0D%0A++++++++++++totalImpulse%5Bk%5D%5Bj%5D+%3D+maxImpulse%3B%0D%0A++++++++++++clamped+%3D+true%3B%0D%0A++++++++++%7D++++++++++%0D%0A++++++++++else+if+%28totalImpulse%5Bk%5D%5Bj%5D+%3C+-maxImpulse%29+%0D%0A++++++++++%7B%0D%0A++++++++++++impulseToApply+%2B%3D+-maxImpulse+-+totalImpulse%5Bk%5D%5Bj%5D%3B%0D%0A++++++++++++totalImpulse%5Bk%5D%5Bj%5D+%3D+-maxImpulse%3B%0D%0A++++++++++++clamped+%3D+true%3B%0D%0A++++++++++%7D++++++++++%0D%0A++++++++%7D%0D%0A%0D%0A++++++++%2F%2F+5.+apply+this+impulse+to+each+body%0D%0A++++++++vel%5B0%5D+.%2B%3D+normals%5Bj%5D+.*+%28up.inverseMass%5B0%5D+*+impulseToApply%29%3B%0D%0A++++++++angVel%5B0%5D+.%2B%3D+deltaAngVel%5Bk%5D%5B0%5D%5Bj%5D+.*+impulseToApply%3B%0D%0A++++++++vel%5B1%5D+.-%3D+normals%5Bj%5D+.*+%28up.inverseMass%5B1%5D+*+impulseToApply%29%3B%0D%0A++++++++angVel%5B1%5D+.-%3D+deltaAngVel%5Bk%5D%5B1%5D%5Bj%5D+.*+impulseToApply%3B%0D%0A%0D%0A++++++++%2F%2F+just+sanity+check+that+ttargetDeltaV+equals+0%0D%0A++++++++if+%28not+clamped%29%0D%0A++++++++%7B%0D%0A++++++++++for+%28i+%3D+0%3B+i%3C2%3B+i%2B%2B%29%0D%0A++++++++++++velNorm%5Bi%5D+%3D+%28vel%5Bi%5D+.%2B+%28toCOM%5Bk%5D%5Bi%5D+.cross+angVel%5Bi%5D%29%29+.dot+normals%5Bj%5D%3B%0D%0A++++++++++Velocity+tnormalVel+%3D+velNorm%5B0%5D+-+velNorm%5B1%5D%3B%0D%0A++++++++++Velocity+ttargetDeltaV+%3D+targetVel%5Bk%5D%5Bj%5D+-+tnormalVel%3B%0D%0A++++++++++if+%28Math.abs%28ttargetDeltaV%29+%3E+0.001%29%0D%0A++++++++++++alert%28%27interaction+react%2C+collision+response+broken%27%29%3B%0D%0A++++++++%7D%0D%0A++++++%7D%0D%0A++++%7D%0D%0A++%7D%0D%0A++%2F%2F+finally%2C+output+the+calculated+impulse+and+angularImpulse+back+to+the+respective+bodies%0D%0A++down.impulse%5B0%5D.set%280%2C0%2C0%29%3B%0D%0A++down.impulse%5B1%5D.set%280%2C0%2C0%29%3B%0D%0A++down.torqueImpulse%5B0%5D.set%280%2C0%2C0%29%3B%0D%0A++down.torqueImpulse%5B1%5D.set%280%2C0%2C0%29%3B%0D%0A++for+%28k+in+points%29++%0D%0A++%7B%0D%0A++++Impulse+imp+%3D+new+Vector3%280%2C0%2C0%29%3B%0D%0A++++for+%28j+%3D+0%3B+j%3C3%3B+j%2B%2B%29%0D%0A++++++imp+.%2B%3D+normals%5Bj%5D+.*+totalImpulse%5Bk%5D%5Bj%5D%3B%0D%0A++++down.impulse%5B0%5D+.%2B%3D+imp%3B%0D%0A++++down.impulse%5B1%5D+.-%3D+imp%3B%0D%0A++++down.torqueImpulse%5B0%5D+.%2B%3D+imp+.cross+toCOM%5Bk%5D%5B0%5D%3B%0D%0A++++down.torqueImpulse%5B1%5D+.-%3D+imp+.cross+toCOM%5Bk%5D%5B1%5D%3B%0D%0A++%7D%0D%0A%7D&generate=for+%28key+in+down%29%0D%0A++out%5Bkey%5D+%3D+down%5Bkey%5D%3B&analyse=for+%28key+in+backIn%29%0D%0A++up%5Bkey%5D+%3D+backIn%5Bkey%5D%3B&save+as=Interaction