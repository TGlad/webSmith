saveChanges?description=a+box+for+rendering%2C+is+separate+from+collision+box.&wikilink=&init=topState.box+%3D+makeBox%28%29%3B%0D%0A%0D%0A%2F%2F+only+create+a+new+shader+if+one+doesn%27t+already+exist%2C+otherwise+share+the+existing+one%0D%0AtopState.shader+%3D+g_objectTypeExists%28BasicShader%29%3B%0D%0Aif+%28not+topState.shader%29+%0D%0A%7B%0D%0A++topState.shader+%3D+new+BasicShader%28%29%3B%0D%0A++g_addObject%28topState.shader%2C+%7Battributes%3A+%5B%22vNormal%22%2C+%22vTexCoord%22%2C+%22vPosition%22%5D%7D%29%3B%0D%0A%7D%0D%0AtopState.renderType+%3D+topState.shader.topState.renderType%3B%0D%0AbackOut.renderExtents+%3D+parameters.extents%3B%0D%0AtopState.extents+%3D+parameters.extents%3B%0D%0AtopState.texture+%3D+marsTexture%3B+%2F%2FloadImageTexture%28parameters.texture%29%3B%0D%0A%0D%0AbackOutDest.renderExtents+%3D+%7Bpointer%3Aparameters.parent.up%2C+name%3A%27renderExtents%27%7D%3B%0D%0AbackOutDest.draw+%3D+%7Bpointer%3Aparameters.parent.up%2C+name%3A%27draw%27%7D%3B%0D%0AbackOutDest.renderType+%3D+%7Bpointer%3Aparameters.parent.up%2C+name%3A%27renderType%27%7D%3B%0D%0A%0D%0Afunction+makeBox%28%29%0D%0A%7B%0D%0A++%2F%2F+box%0D%0A++%2F%2F++++v6-----+v5%0D%0A++%2F%2F+++%2F%7C++++++%2F%7C%0D%0A++%2F%2F++v1------v0%7C%0D%0A++%2F%2F++%7C+%7C+++++%7C+%7C%0D%0A++%2F%2F++%7C+%7Cv7---%7C-%7Cv4%0D%0A++%2F%2F++%7C%2F++++++%7C%2F%0D%0A++%2F%2F++v2------v3%0D%0A++%2F%2F%0D%0A++%2F%2F+vertex+coords+array%0D%0A++var+vertices+%3D+new+WebGLFloatArray%28%0D%0A++++++++%5B1%2C+1%2C+1%2C+-1%2C+1%2C+1%2C+-1%2C+-1%2C+1%2C+1%2C+-1%2C+1%2C++++%2F%2F+v0-v1-v2-v3+front%0D%0A+++++++++++1%2C+1%2C+1%2C+1%2C+-1%2C+1%2C+1%2C+-1%2C+-1%2C+1%2C+1%2C+-1%2C++++%2F%2F+v0-v3-v4-v5+right%0D%0A+++++++++++1%2C+1%2C+1%2C+1%2C+1%2C+-1%2C+-1%2C+1%2C+-1%2C+-1%2C+1%2C+1%2C++++%2F%2F+v0-v5-v6-v1+top%0D%0A++++++++++-1%2C+1%2C+1%2C+-1%2C+1%2C+-1%2C+-1%2C+-1%2C+-1%2C+-1%2C+-1%2C+1%2C++++%2F%2F+v1-v6-v7-v2+left%0D%0A++++++++++-1%2C+-1%2C+-1%2C+1%2C+-1%2C+-1%2C+1%2C+-1%2C+1%2C+-1%2C+-1%2C+1%2C++++%2F%2F+v7-v4-v3-v2+bottom%0D%0A+++++++++++1%2C+-1%2C+-1%2C+-1%2C+-1%2C+-1%2C+-1%2C+1%2C+-1%2C+1%2C+1%2C+-1%5D+++%2F%2F+v4-v7-v6-v5+back%0D%0A++++%29%3B%0D%0A%0D%0A++%2F%2F+normal+array%0D%0A++var+normals+%3D+new+WebGLFloatArray%28%0D%0A++++++++%5B0%2C+0%2C+1%2C+0%2C+0%2C+1%2C+0%2C+0%2C+1%2C+0%2C+0%2C+1%2C+++++%2F%2F+v0-v1-v2-v3+front%0D%0A+++++++++++1%2C+0%2C+0%2C+1%2C+0%2C+0%2C+1%2C+0%2C+0%2C+1%2C+0%2C+0%2C+++++%2F%2F+v0-v3-v4-v5+right%0D%0A+++++++++++0%2C+1%2C+0%2C+0%2C+1%2C+0%2C+0%2C+1%2C+0%2C+0%2C+1%2C+0%2C+++++%2F%2F+v0-v5-v6-v1+top%0D%0A++++++++++-1%2C+0%2C+0%2C+-1%2C+0%2C+0%2C+-1%2C+0%2C+0%2C+-1%2C+0%2C+0%2C+++++%2F%2F+v1-v6-v7-v2+left%0D%0A+++++++++++0%2C+-1%2C+0%2C+0%2C+-1%2C+0%2C+0%2C+-1%2C+0%2C+0%2C+-1%2C+0%2C+++++%2F%2F+v7-v4-v3-v2+bottom%0D%0A+++++++++++0%2C+0%2C+-1%2C+0%2C+0%2C+-1%2C+0%2C+0%2C+-1%2C+0%2C+0%2C+-1%5D++++%2F%2F+v4-v7-v6-v5+back%0D%0A+++++++%29%3B%0D%0A%0D%0A%0D%0A++%2F%2F+texCoord+array%0D%0A++var+texCoords+%3D+new+WebGLFloatArray%28%0D%0A++++++++%5B1%2C+1%2C+0%2C+1%2C+0%2C+0%2C+1%2C+0%2C++++%2F%2F+v0-v1-v2-v3+front%0D%0A+++++++++++0%2C+1%2C+0%2C+0%2C+1%2C+0%2C+1%2C+1%2C++++%2F%2F+v0-v3-v4-v5+right%0D%0A+++++++++++1%2C+0%2C+1%2C+1%2C+0%2C+1%2C+0%2C+0%2C++++%2F%2F+v0-v5-v6-v1+top%0D%0A+++++++++++1%2C+1%2C+0%2C+1%2C+0%2C+0%2C+1%2C+0%2C++++%2F%2F+v1-v6-v7-v2+left%0D%0A+++++++++++0%2C+0%2C+1%2C+0%2C+1%2C+1%2C+0%2C+1%2C++++%2F%2F+v7-v4-v3-v2+bottom%0D%0A+++++++++++0%2C+0%2C+1%2C+0%2C+1%2C+1%2C+0%2C+1%5D+++%2F%2F+v4-v7-v6-v5+back%0D%0A+++++++%29%3B%0D%0A%0D%0A++%2F%2F+index+array%0D%0A++var+indices+%3D+new+WebGLUnsignedByteArray%28%0D%0A++++++++%5B0%2C+1%2C+2%2C+0%2C+2%2C+3%2C++++%2F%2F+front%0D%0A+++++++++++4%2C+5%2C+6%2C+4%2C+6%2C+7%2C++++%2F%2F+right%0D%0A+++++++++++8%2C+9%2C+10%2C+8%2C+10%2C+11%2C++++%2F%2F+top%0D%0A++++++++++12%2C+13%2C+14%2C+12%2C+14%2C+15%2C++++%2F%2F+left%0D%0A++++++++++16%2C+17%2C+18%2C+16%2C+18%2C+19%2C++++%2F%2F+bottom%0D%0A++++++++++20%2C+21%2C+22%2C+20%2C+22%2C+23%5D+++%2F%2F+back%0D%0A++++++%29%3B%0D%0A%0D%0A++var+retval+%3D+%7B%7D%3B%0D%0A%0D%0A++retval.normalObject+%3D+g_graphics.createBuffer%28%29%3B%0D%0A++g_graphics.bindBuffer%28g_graphics.ARRAY_BUFFER%2C+retval.normalObject%29%3B%0D%0A++g_graphics.bufferData%28g_graphics.ARRAY_BUFFER%2C+normals%2C+g_graphics.STATIC_DRAW%29%3B%0D%0A%0D%0A++retval.texCoordObject+%3D+g_graphics.createBuffer%28%29%3B%0D%0A++g_graphics.bindBuffer%28g_graphics.ARRAY_BUFFER%2C+retval.texCoordObject%29%3B%0D%0A++g_graphics.bufferData%28g_graphics.ARRAY_BUFFER%2C+texCoords%2C+g_graphics.STATIC_DRAW%29%3B%0D%0A%0D%0A++retval.vertexObject+%3D+g_graphics.createBuffer%28%29%3B%0D%0A++g_graphics.bindBuffer%28g_graphics.ARRAY_BUFFER%2C+retval.vertexObject%29%3B%0D%0A++g_graphics.bufferData%28g_graphics.ARRAY_BUFFER%2C+vertices%2C+g_graphics.STATIC_DRAW%29%3B%0D%0A%0D%0A++g_graphics.bindBuffer%28g_graphics.ARRAY_BUFFER%2C+null%29%3B%0D%0A%0D%0A++retval.indexObject+%3D+g_graphics.createBuffer%28%29%3B%0D%0A++g_graphics.bindBuffer%28g_graphics.ELEMENT_ARRAY_BUFFER%2C+retval.indexObject%29%3B%0D%0A++g_graphics.bufferData%28g_graphics.ELEMENT_ARRAY_BUFFER%2C+indices%2C+g_graphics.STATIC_DRAW%29%3B%0D%0A++g_graphics.bindBuffer%28g_graphics.ELEMENT_ARRAY_BUFFER%2C+null%29%3B%0D%0A%0D%0A++retval.numIndices+%3D+indices.length%3B%0D%0A%0D%0A++return+retval%3B%0D%0A%7D%0D%0A%0D%0A%0D%0A&receive=for+%28key+in+in%29%0D%0A++down%5Bkey%5D+%3D+in%5Bkey%5D%3B&reply=for+%28key+in+up%29%0D%0A++backOut%5Bkey%5D+%3D+up%5Bkey%5D%3B%0D%0AbackOut.renderType+%3D+topState.renderType%3B%0D%0A%0D%0A&predict=up.draw+%3D+function%28ctx%2C+transform%2C+projection%29%0D%0A%7B%0D%0A++ctx.enableVertexAttribArray%280%29%3B%0D%0A++ctx.enableVertexAttribArray%281%29%3B%0D%0A++ctx.enableVertexAttribArray%282%29%3B%0D%0A%0D%0A++ctx.bindBuffer%28ctx.ARRAY_BUFFER%2C+topState.box.vertexObject%29%3B%0D%0A++ctx.vertexAttribPointer%282%2C+3%2C+ctx.FLOAT%2C+false%2C+0%2C+0%29%3B%0D%0A%0D%0A++ctx.bindBuffer%28ctx.ARRAY_BUFFER%2C+topState.box.normalObject%29%3B%0D%0A++ctx.vertexAttribPointer%280%2C+3%2C+ctx.FLOAT%2C+false%2C+0%2C+0%29%3B%0D%0A%0D%0A++ctx.bindBuffer%28ctx.ARRAY_BUFFER%2C+topState.box.texCoordObject%29%3B%0D%0A++ctx.vertexAttribPointer%281%2C+2%2C+ctx.FLOAT%2C+false%2C+0%2C+0%29%3B%0D%0A%0D%0A++ctx.bindBuffer%28ctx.ELEMENT_ARRAY_BUFFER%2C+topState.box.indexObject%29%3B%0D%0A%0D%0A++%2F%2F+generate+the+model-view+matrix%0D%0A++var+mvMatrix+%3D+new+J3DIMatrix4%28transform%29%3B%0D%0A++mvMatrix.scale%28topState.extents%29%3B%0D%0A%0D%0A++%2F%2F+construct+the+normal+matrix+from+the+model-view+matrix%0D%0A++var+normalMatrix+%3D+new+J3DIMatrix4%28mvMatrix%29%3B%0D%0A++normalMatrix.invert%28%29%3B%0D%0A++normalMatrix.transpose%28%29%3B%0D%0A++normalMatrix.setUniform%28ctx%2C+ctx.getUniformLocation%28topState.renderType%2C+%22u_normalMatrix%22%29%2C+false%29%3B%0D%0A%0D%0A++%2F%2F+construct+the+model-view+*+projection+matrix%0D%0A++var+mvpMatrix+%3D+new+J3DIMatrix4%28projection%29%3B%0D%0A++mvpMatrix.multiply%28mvMatrix%29%3B%0D%0A++mvpMatrix.setUniform%28ctx%2C+ctx.getUniformLocation%28topState.renderType%2C+%22u_modelViewProjMatrix%22%29%2C+false%29%3B%0D%0A%0D%0A++ctx.bindTexture%28ctx.TEXTURE_2D%2C+topState.texture%29%3B%0D%0A++ctx.drawElements%28ctx.TRIANGLES%2C+topState.box.numIndices%2C+ctx.UNSIGNED_BYTE%2C+0%29%3B%0D%0A%7D&react=&generate=&analyse=&save+as=RenderBox