saveChanges?description=A+character+is+either+a+human+user+of+the+virtual+world+or+is+an+AI+approximation+of+a+user.+The+control+may+employ+AI+and+user+input+in+combination.&wikilink=&init=topState.position+%3D+parameters.position%3B%0D%0AtopState.yaw+%3D+0%3B%0D%0A%2F%2F+base+state+duplicates+some+of+topState%2C+as+both+halves+need+this+info%0D%0AbaseState.position+%3D+topState.position%3B%0D%0AbaseState.yaw+%3D+0%3B%0D%0AbaseState.leftHandTransform+%3D+new+Transform%28%29%3B%0D%0AbaseState.leftHandTransform.pos.set%281%2C+0%2C+1.5%29%3B%0D%0AbaseState.rightHandTransform+%3D+new+Transform%28%29%3B%0D%0AbaseState.rightHandTransform.pos.set%28-1%2C+0%2C+1.5%29%3B%0D%0Aout.leftHandTransform+%3D+new+Transform%28%29%3B%0D%0Aout.rightHandTransform+%3D+new+Transform%28%29%3B%0D%0A%0D%0A%0D%0A%2F%2F+ok+so+when+we+create+a+character%2C+it+needs+a+physical+presence+%28a+rigidBody%29+and+a+camera%0D%0A%2F%2F+the+camera%27s+position+is+local+to+the+character%27s+rigid+body%0D%0APosition+localSpaceCamera+%3D+new+Vector3%280%2C+0%2C+0%29%3B+%0D%0AbaseState.frustumGradientX+%3D+0.8%3B%0D%0AbaseState.frustumGradientY+%3D+0.4%3B%0D%0Avar+camera+%3D+new+Camera%28%29%3B%0D%0Ag_addObject%28camera%2C+%7B+position%3A+localSpaceCamera%2C+scene%3A+parameters.scene%2C+screen%3A+parameters.screen%2C+%0D%0A++++++++++++++++++++++frustumGradientX%3A+baseState.frustumGradientX%2C+frustumGradientY%3A+baseState.frustumGradientY%7D%29%3B%0D%0A%0D%0A%2F%2F+now+add+rigid+body%0D%0Avar+rigidBody+%3D+new+RigidBody%28%29%3B%0D%0A%2F%2F+a+little+code+here%2C+no+texture+means+nothing+to+render%2C+therefore+no+render+box+will+be+generated...+makes+sense+right%3F%0D%0Avar+bodyParams+%3D+%7Bscene%3A+parameters.scene%2C+type%3A+%22box%22%2C+position%3A+baseState.position%2C+extents%3A+new+Vector3%281%2C1%2C1%29%7D%3B%0D%0Ag_addObject%28rigidBody%2C+bodyParams%29%3B%0D%0A%2F%2F+now+add+each+hand+as+a+render+object%0D%0Avar+leftHand+%3D+new+RigidBody%28%29%3B%0D%0Ag_addObject%28leftHand%2C+%7Bscene%3A+parameters.scene%2Ctype%3A+%22box%22%2C+position%3A+baseState.position%2Ctexture%3A%22textures%2Fmars500x250.png%22%2C+extents%3Anew+Vector3%280.1%2C0.1%2C0.1%29%2C+parent%3ArigidBody%7D%29%3B%0D%0AoutDest.leftHandTransform+%3D+%7Bpointer%3AleftHand.in%2C+name%3A%27targetTransform%27%7D%3B%0D%0Avar+rightHand+%3D+new+RigidBody%28%29%3B%0D%0Ag_addObject%28rightHand%2C+%7Bscene%3A+parameters.scene%2Ctype%3A+%22box%22%2C+position%3A+baseState.position%2Ctexture%3A%22textures%2Fmars500x250.png%22%2C+extents%3Anew+Vector3%280.1%2C0.1%2C0.1%29%2C+parent%3ArigidBody%7D%29%3B%0D%0AoutDest.rightHandTransform+%3D+%7Bpointer%3ArightHand.in%2C+name%3A%27targetTransform%27%7D%3B%0D%0A%0D%0AbackInSource.transform+%3D+%7Bpointer%3ArigidBody.backOut.object%2C+name%3A%27transform%27%7D%3B%0D%0AoutDest.targetVel+%3D+%7Bpointer%3ArigidBody.in%2C+name%3A%27targetVel%27%7D%3B%0D%0AoutDest.targetAngularVel+%3D+%7Bpointer%3ArigidBody.in%2C+name%3A%27targetAngularVel%27%7D%3B%0D%0A%0D%0A%2F%2F+now+attach+the+camera+to+the+rigid+body%0D%0Acamera.attachToBody%28rigidBody%29%3B%0D%0A%0D%0Adown.forwardsVel+%3D+0%3B%0D%0Adown.strafeRightVel+%3D+0%3B%0D%0Adown.turnLeftVel+%3D+0%3B&receive=&reply=&predict=&react=baseState.yaw+%3D+up.yaw%3B&generate=%2F%2F+convert+target+vel+commands+into+world+space%0D%0ADirection+forwards+%3D+new+Vector3%28Math.sin%28baseState.yaw%29%2C+0%2C+Math.cos%28baseState.yaw%29%29%3B%0D%0ADirection+right+%3D+new+Vector3%28-forwards.z%2C+0%2C+forwards.x%29%3B%0D%0A%0D%0Aout.targetVel+%3D+%28forwards+.*+down.forwardsVel%29+.%2B+%28right+.*+down.strafeRightVel%29%3B%0D%0Aout.targetAngularVel+%3D+new+Vector3%280%2C+down.turnLeftVel%2C+0%29%3B%0D%0A%0D%0A%2F%2F+base+state+hand+transforms+are+in+local+view+space%2C+so+convert+them+%0D%0A%2F%2F+using+the+frustum%0D%0Avar+transform+%3D+new+Transform%28new+Quaternion%280%2CbaseState.yaw%2C0%29%2C+baseState.position%29%3B%0D%0A%0D%0APosition+localPos+%3D+baseState.leftHandTransform.pos%3B%0D%0APosition+leftPos+%3D+new+Vector3%28localPos.x*localPos.z*baseState.frustumGradientX%2C%0D%0A+++++++++++++++++++++++++++++++localPos.y*localPos.z*baseState.frustumGradientY%2C%0D%0A+++++++++++++++++++++++++++++++localPos.z%29%3B%0D%0Avar+leftTMLocal%3D+new+Transform%28baseState.leftHandTransform.quat%2C+leftPos%29%3B%0D%0Aout.leftHandTransform.set%28transform+.*+leftTMLocal%29%3B%0D%0A%0D%0AlocalPos+%3D+baseState.rightHandTransform.pos%3B%0D%0APosition+rightPos+%3D+new+Vector3%28localPos.x*localPos.z*baseState.frustumGradientX%2C%0D%0A++++++++++++++++++++++++++++++++localPos.y*localPos.z*baseState.frustumGradientY%2C%0D%0A++++++++++++++++++++++++++++++++localPos.z%29%3B%0D%0Avar+rightTMLocal+%3D+new+Transform%28baseState.rightHandTransform.quat%2C+rightPos%29%3B%0D%0Aout.rightHandTransform.set%28transform+.*+rightTMLocal%29%3B&analyse=baseState.position+%3D+backIn.transform.pos%3B%0D%0Avar+tm+%3D+backIn.transform%3B%0D%0Aup.yaw+%3D+tm+%3F+tm.quat.getRotationVector%28%29.y+%3A+0%3B&save+as=Character